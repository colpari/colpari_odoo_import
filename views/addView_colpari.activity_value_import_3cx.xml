<?xml version="1.0"?>
<odoo>
  <data>
    <!-- 3cx_imports list -->
    <record id="3cx_imports_tree" model="ir.ui.view">
      <field name="name">colpari.3cx_imports.tree</field>
      <field name="model">colpari.activity_value_import_3cx</field>
      <field name="groups_id" eval="[(4, ref('colpari_services.group_colpari_user'))]"/>      
      <field name="arch" type="xml">
        <tree string="3CX imports" sample="1"
          decoration-danger="last_run_state == 'fail'"
          decoration-warning="last_run_state == 'warn'" 
        > <!-- editable="bottom" delete="1" multi_edit="0" edit="0" -->
          <field name="name" />
          <field name="project_id" />
          <field name="last_run_state"/>
          <field name="action_type_inbound" />
          <field name="action_type_outbound" />
          <field name="action_unit" />
          <field name="query_service_url" />
          <field name="dialout_prefix"/>
          <field name="queue_name" />
          <field name="next_import_range_start" />
          <field name="auto_execute" />
          <field name="auto_accounting" />
          <button name="executeThis" string="Execute" type="object" class="oe_highlight"/>
          <!-- <field name="last_imported_time" readonly="True" /> -->
          <!-- <field name="runs" readonly="True" /> -->
        </tree>
      </field>
    </record>

    <!-- 3cx_imports form -->
    <record id="3cx_imports_form" model="ir.ui.view">
      <field name="name">colpari.3cx_imports.form</field>
      <field name="model">colpari.activity_value_import_3cx</field>
      <field name="groups_id" eval="[(4, ref('colpari_services.group_colpari_user'))]"/>      
      <field name="arch" type="xml">
        <form>
          <sheet>
            <h2><field name="name"/> (3CX import)</h2>
            <group>
              <field name="last_run_state" decoration-danger="last_run_state == 'fail'" decoration-warning="last_run_state == 'warn'" />
              <field name="project_id" />
              <field name="action_type_inbound" />
              <field name="action_type_outbound" />
              <field name="action_unit" />
              <field name="query_service_url" />
              <field name="auth_token" password="True" />
              <field name="dialout_prefix"/>
              <field name="queue_name" />
              <field name="ignore_extensions" />
              <field name="ignore_fromTypes" />
              <field name="ignore_toTypes" />
              <field name="ignore_typeCombinations" />              
              <field name="outbound_count_ringtime" />
              <field name="ignore_0duration" />
              <field name="project_accounting_interval" />
              <field name="query_range_start_mode" />
              <field name="query_range_end_mode" />
              <field name="next_import_range_start" />
              <field name="auto_execute" />
              <field name="auto_accounting" />
              <field name="debug" />
              <button name="executeThis" string="Execute this import now" type="object" class="oe_highlight"/>
            </group>
            <h3>Runs:</h3>
            <field name="runs" readonly="True" />
          </sheet>
        </form>
      </field>
    </record>


    <!-- action to run 3cx imports -->
    <record model="ir.actions.server" id="3cx_imports_run">
      <field name="name">Run 3CX import(s)</field>
      <field name="model_id" ref="model_colpari_activity_value_import_3cx" />
      <field name="binding_model_id" ref="model_colpari_activity_value_import_3cx"/>
      <field name="state">code</field>
      <field name="code">
log("m={}, r={}, rs={}".format(model, record, records), level='info')
records.execute()
      </field>
    </record>


    <!-- action for 3cx_imports list-->
    <record model="ir.actions.act_window" id="act_3cx_imports_window">
      <field name="name">colpari 3cx imports</field>
      <field name="res_model">colpari.activity_value_import_3cx</field>
      <field name="view_mode">tree,kanban,form</field>
    </record>

    <!-- action for auto-scheduled imports FIXME: move to separate place / base class -->
    <record id="ir_cron_colpari_autoimports" model="ir.cron">
      <field name="name">Execute automatic imports</field>
      <field name="model_id" ref="model_colpari_activity_value_import_3cx"/>
      <field name="state">code</field>
      <field name="code">model.executeAllAutoImports()</field>
      <field name="interval_number">30</field>
      <field name="interval_type">minutes</field>
      <field name="numbercall">-1</field>
      <!-- <field name="nextcall" eval="(DateTime.now().replace(hour=3, minute=0) + timedelta(days=1)).strftime('%Y-%m-%d %H:%M:%S')" /> -->
    </record>    

  </data>    
</odoo>