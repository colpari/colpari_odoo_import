<?xml version="1.0"?>
<odoo>
  <data>
    <!-- change normal project form view -->
    <record id="edit_project" model="ir.ui.view">
      <field name="name">project.project.form</field>
      <field name="model">project.project</field>
      <field name="inherit_id" ref="project.edit_project"/>
      <field name="groups_id" eval="[(4, ref('colpari_services.group_colpari_user'))]"/>      
      <field name="arch" type="xml">

        <!-- add parent project and colpari client before user id (Customer) -->
        <field name="user_id" position="before">
          <field name="colpari_client"/>
          <field name="parent_project_id"/>
          <field name="colpari_currency_id"/>
          <field name="accounting_interval"/>
          <field name="account_child_projects"/>
          <field name="invoice_child_projects"/>
        </field>


        <!-- insert our settings into the settings tab, group extra_settings -->
        <xpath expr="//notebook/page[@name='settings']/group/group[@name='extra_settings']" position="inside">
          <field name="create_authz_groups" />
        </xpath>        
        
        <!-- add our pages after the description page... -->
        <xpath expr="//page[@name='description']" position="after">
        
          <!-- contract details page -->
          <page name="project_contract" string="Contract">
            <h3>Contract preamble</h3>
            <field name="contract_preamble"/>
            <br/><br/>
            <h3>Partner order description</h3>
            <field name="partner_order_description"/>
            <br/><br/>
            <h3>Service levels</h3>
            <field name="service_levels"/>
          </page>

          <!-- skills page TODO: autogenerated minimum skills from prices? -->
          <page name="colpari_skills" string="Required skills">
            <field name="skills" options="{'no_open': True}" context="{'no_create_edit': True}" />
          </page>
         
          
          <!-- assigned partners page -->
          <page name="project_partners" string="colpari Partners">
            <field name="partner_assignments">
              <tree editable="top">
                <field name="partner_id"/>
                <field name="role_ids" widget="many2many_tags"/>
                <field name="write_date" />
              </tree>
            </field>
          </page>

          <!-- activities -->
          <page name='colpari_activities' string='Activities'>
            <field name='colpari_activities' string='Activities' help='Activities in this project' context="{'default_project_id' : active_id}"/>
          </page>

          <!-- prices/compensation page -->
          <page name='colpari_prices_accounting' string='Prices/Compensation'>
            <h2>Price lists</h2>
            <field name='accounting_price_lists' string='Accounting pricelists' help="Activity prices accounted to clients"/>
            <h2>Compensation lists</h2>
            <field name='compensation_price_lists' string='Compensation price lists' help="Activity prices paid to partners"/>
          </page>

          <!-- payments page -->
          <page name='colpari_project_payments' string='Payments'>
            <h2>from Clients</h2>
            <field name='client_payments' string='Client payments' help="Payments accounted to clients"/>
            <h2>to Partners</h2>
            <field name='partner_payments' string='Partner payments' help="Payments accounted to partners"/>
          </page>

          <!-- assigned features page -->
          <page name='colpari_platform_features' string='Partner Platform Features'>
            <h2>Platform feature sets for partners on this project</h2>
            <group>
              <field name='colpari_feature_sets' string='Assigned feature sets' widget='many2many_checkboxes'/>
            </group>
            <br/><br/>
            <h2>Platform single features for partners on this project</h2>
            <group>
              <field name='colpari_features' string='Directly assigned features' widget='many2many_checkboxes'/>
            </group>
            <br/><br/>
            <h2>Resulting effective features for partners on this project</h2>
            <group>
              <field name='effective_features' string='Effective features'
                help="All effective features of this project and it's parent projects" widget='many2many_checkboxes'/>
            </group>
          </page>

          <!-- related LDAP mnappings -->
          <page name="project_ldap_mappings" string="LDAP mappings">
            <field name="related_ldap_mappings"/>
          </page>

          <!-- effective features page -->
          <!-- <page name='colpari_features_effective' string='Effective features'>
            <group>
              <field name='effective_features' string='Effective features'
                help="All effective features of this project and it's parent projects" widget='many2many_checkboxes'/>
            </group>
          </page> -->

        </xpath>
      </field>
    </record>
  </data>
</odoo>
